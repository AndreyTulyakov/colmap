trigger:
- dev

pool:
  vmImage: 'ubuntu-18.04'

steps:
- script: |
    sudo apt update && sudo apt install -y \
      build-essential \
      libboost-program-options-dev \
      libboost-filesystem-dev \
      libboost-graph-dev \
      libboost-system-dev \
      libboost-test-dev \
      libeigen3-dev \
      libsuitesparse-dev \
      libfreeimage-dev \
      libgoogle-glog-dev \
      libgflags-dev \
      libglew-dev \
      qtbase5-dev \
      libqt5opengl5-dev \
      libcgal-dev \
      libcgal-qt5-dev
  displayName: 'Install dependencies'

- script: |
    mkdir -p deps
    cd deps
    if [[ -z "$(ls -A ceres-solver)" ]]; then
      git clone https://ceres-solver.googlesource.com/ceres-solver
    fi
    cd ceres-solver
    git pull
    git checkout 2.0.0
    mkdir -p build
    cd build
    cmake .. \
      -DBUILD_TESTING=OFF \
      -DBUILD_EXAMPLES=OFF \
      -GNinja
    ninja
    sudo ninja install

- script: |
    cmake --version
    mkdir build
    cd build
    cmake .. -GNinja
    ninja
